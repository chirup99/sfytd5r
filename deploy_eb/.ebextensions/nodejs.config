option_settings:
  aws:elasticbeanstalk:container:nodejs:
    NodeCommand: "npm start"
    ProxyServer: nginx
    GzipCompression: true
  aws:elasticbeanstalk:cloudwatch:logs:
    StreamLogs: true
    DeleteOnTerminate: false
    RetentionInDays: 7
  aws:elasticbeanstalk:application:environment:
    NODE_ENV: production
    NODE_OPTIONS: "--max-old-space-size=512"
  aws:autoscaling:launchconfiguration:
    EC2KeyName: ""
    InstanceType: t3.medium
    
commands:
  01_install_deps:
    command: |
      if [ ! -d "node_modules" ]; then
        npm ci --production
      fi
    ignoreErrors: true

container_commands:
  01_ensure_start_script:
    command: |
      if [ -f "dist/index.js" ]; then
        echo "✅ Server bundle exists"
      else
        echo "❌ Server bundle missing!"
        exit 1
      fi